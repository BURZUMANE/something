{"ast":null,"code":"import { api } from \"../configs/axiosConfig\";\nimport { defineCancelApiObject } from \"../configs/axiosUtils\";\nfunction getState(events, match) {\n  // Find the last event with the correct event type which is also the current match state.\n  for (let i = events.length - 1; i >= 0; i--) {\n    if (events[i].match_id === match.match_id && (events[i].event_type === \"match_start\" || events[i].event_type === \"match_halftime\" || events[i].event_type === \"match_end\")) {\n      return events[i].event_type.split('_').join(' ');\n    }\n  }\n  return \"didn't start\";\n}\nfunction getScoreForTeam(events, match, teamId) {\n  const scoreTeam = teamId === match.home_team_id ? \"home\" : \"away\";\n  let score = events.filter(event => event.event_type === \"goal\" && event.match_id === match.match_id && event.score_team === scoreTeam).map(event => event.score_amount || 0).reduce((sum, current) => sum + current, 0);\n  return score;\n}\nfunction getTeam(teams, events, match, teamId, flagsLink) {\n  const team = teams.find(item => item.team_id === teamId);\n  if (!team) {\n    return null;\n  }\n  const name = team.team_name;\n  const shortName = team.team_name_short;\n  const flagLink = flagsLink + `logo_${teamId}.png`;\n  const score = getScoreForTeam(events, match, teamId);\n  return {\n    name,\n    shortName,\n    flagLink,\n    score\n  };\n}\nfunction mapMatches(data, teamLogoLink) {\n  let matches = data.matches.reduce((acc, currMatch) => {\n    const homeTeam = getTeam(data.teams, data.events, currMatch, currMatch.home_team_id, teamLogoLink);\n    const awayTeam = getTeam(data.teams, data.events, currMatch, currMatch.away_team_id, teamLogoLink);\n    homeTeam && awayTeam && acc.push({\n      id: currMatch.match_id,\n      homeTeam,\n      awayTeam,\n      state: getState(data.events, currMatch)\n    });\n    return acc;\n  }, []);\n  return matches;\n}\nexport const MatchAPI = {\n  getAllMatches: async function () {\n    let cancel = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    try {\n      const response = await api.get('', {\n        signal: cancelApiObject['getAllMatches'].handleRequestCancellation().signal\n      });\n      return mapMatches(response.data, api.defaults.baseURL + '/images/');\n    } catch (error) {\n      return [];\n    }\n  }\n};\nexport const cancelApiObject = defineCancelApiObject(MatchAPI);","map":{"version":3,"names":["api","defineCancelApiObject","getState","events","match","i","length","match_id","event_type","split","join","getScoreForTeam","teamId","scoreTeam","home_team_id","score","filter","event","score_team","map","score_amount","reduce","sum","current","getTeam","teams","flagsLink","team","find","item","team_id","name","team_name","shortName","team_name_short","flagLink","mapMatches","data","teamLogoLink","matches","acc","currMatch","homeTeam","awayTeam","away_team_id","push","id","state","MatchAPI","getAllMatches","cancel","response","get","signal","cancelApiObject","handleRequestCancellation","defaults","baseURL","error"],"sources":["/Users/puz/something/src/apis/MatchAPI/MatchAPI.ts"],"sourcesContent":["import {api} from \"../configs/axiosConfig\";\nimport {defineCancelApiObject} from \"../configs/axiosUtils\";\n\nexport interface IMatchEvent {\n  event_id: number,\n  event_type: string,\n  event_time: number,\n  match_id: number,\n  score_amount?: number,\n  score_team?: string\n}\n\nexport interface ITeam {\n  team_id: number,\n  team_name: string,\n  team_name_short: string\n}\n\nexport interface IMatch {\n  match_id: number,\n  tournament_id: number,\n  round: number,\n  home_team_id: number,\n  away_team_id: number\n}\n\nexport interface IGetAllMatchesResponse {\n  \"phase\": string,\n  \"teams\": ITeam[],\n  \"matches\": IMatch[],\n  \"events\": any[]\n}\n\nexport interface IUIMappedTeam {\n  name: string,\n  shortName: string,\n  flagLink: string,\n  score: number\n}\n\nexport interface IUIMappedMatch {\n  id: number,\n  homeTeam: IUIMappedTeam\n  awayTeam: IUIMappedTeam,\n  state: string\n}\n\nfunction getState(events: IMatchEvent[], match: IMatch) {\n  // Find the last event with the correct event type which is also the current match state.\n  for (let i = events.length - 1; i >= 0; i--) {\n    if ((events[i].match_id === match.match_id) &&\n      ((events[i].event_type === \"match_start\") ||\n        (events[i].event_type === \"match_halftime\") ||\n        (events[i].event_type === \"match_end\"))) {\n      return events[i].event_type.split('_').join(' ');\n    }\n  }\n\n  return \"didn't start\";\n}\n\nfunction getScoreForTeam(events: IMatchEvent[], match: IMatch, teamId: number) {\n  const scoreTeam = teamId === match.home_team_id ? \"home\" : \"away\";\n  let score = events\n    .filter(event => event.event_type === \"goal\" && event.match_id === match.match_id && event.score_team === scoreTeam)\n    .map(event => event.score_amount || 0)\n    .reduce((sum, current) => sum + current, 0);\n\n  return score;\n}\n\nfunction getTeam(teams: ITeam[], events: any[], match: IMatch, teamId: number, flagsLink: string) {\n  const team = teams.find(item => item.team_id === teamId);\n\n  if (!team) {\n    return null;\n  }\n\n  const name = team.team_name;\n  const shortName = team.team_name_short;\n  const flagLink = flagsLink + `logo_${teamId}.png`;\n  const score = getScoreForTeam(events, match, teamId);\n\n  return {\n    name,\n    shortName,\n    flagLink,\n    score\n  };\n}\n\nfunction mapMatches(data: IGetAllMatchesResponse, teamLogoLink: string): IUIMappedMatch[] {\n  let matches = data.matches.reduce((acc: IUIMappedMatch[], currMatch) => {\n    const homeTeam = getTeam(data.teams, data.events, currMatch, currMatch.home_team_id, teamLogoLink)\n    const awayTeam = getTeam(data.teams, data.events, currMatch, currMatch.away_team_id, teamLogoLink);\n\n    (homeTeam && awayTeam) &&\n    acc.push({\n      id: currMatch.match_id,\n      homeTeam,\n      awayTeam,\n      state: getState(data.events, currMatch)\n    })\n    return acc;\n  }, [])\n\n  return matches;\n}\n\nexport const MatchAPI = {\n  getAllMatches: async function (cancel = false): Promise<IUIMappedMatch[]> {\n    try {\n      const response = await api.get<IGetAllMatchesResponse>('', {\n        signal: cancelApiObject['getAllMatches'].handleRequestCancellation().signal,\n      })\n\n      return mapMatches(response.data, api.defaults.baseURL + '/images/')\n    } catch (error) {\n      return []\n    }\n  },\n}\n\nexport const cancelApiObject = defineCancelApiObject(MatchAPI)\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}